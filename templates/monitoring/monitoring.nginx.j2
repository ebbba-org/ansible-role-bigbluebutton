{% if not bbb_monitoring_all_in_one_external | bool %}
location /monitoring/ {
  proxy_pass http://127.0.0.1:{{ bbb_monitoring_all_in_one_port }}/;
  include proxy_params;
}
{% else %}
location {{ bbb_monitoring_metrics_endpoint }} {
  proxy_pass http://127.0.0.1:9688/metrics;
  {% if bbb_monitoring_all_in_one_ip_restriction | bool %}
{% for item in bbb_monitoring_ips %}
    allow {{ item.address }};
{% endfor %}
    # drop rest of the world
    deny all;
  {% endif %}

  {% if not bbb_monitoring_all_in_one_ip_restriction or bbb_monitoring_all_in_one_ip_htpasswd_restriction %}
    auth_basic "BigBlueButton Exporter";
    auth_basic_user_file /etc/bigbluebutton/nginx/.htpasswd;
  {% endif %}
  include proxy_params;
}

location {{ bbb_monitoring_node_exporter_endpoint }} {
  proxy_pass http://127.0.0.1:9100/;
  {% if bbb_monitoring_all_in_one_ip_restriction | bool %}
{% for item in bbb_monitoring_ips %}
    allow {{ item.address }};
{% endfor %}
    # drop rest of the world
    deny all;
  {% endif %}

  {% if not bbb_monitoring_all_in_one_ip_restriction or bbb_monitoring_all_in_one_ip_htpasswd_restriction %}
    auth_basic "BigBlueButton Exporter";
    auth_basic_user_file /etc/bigbluebutton/nginx/.htpasswd;
  {% endif %}
  include proxy_params;
}
{% endif %}